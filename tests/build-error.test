// This is an LLVM-style lit test.
// The test checks that xunused returns an error
// if there is a build error in one of the sources.
//
// RUN: rm -rf %t && mkdir -p %t
// RUN: split-file %s %t
// RUN: sed -e "s|TESTDIR|%t|g" %t/compile_commands.json.in > %t/compile_commands.json
// RUN: not xunused %t/compile_commands.json 2>&1

//--- build-error1.cc
int main() { return 0; }

//--- build-error2.cc
#error Test compilation error

//--- build-error3.cc
int main() { return 0; }

//--- compile_commands.json.in
[
  {
    "directory": "TESTDIR",
    "command": "cc -c TESTDIR/build-error1.cc",
    "file": "TESTDIR/build-error1.cc"
  },
  {
    "directory": "TESTDIR",
    "command": "cc -c TESTDIR/build-error2.cc",
    "file": "TESTDIR/build-error2.cc"
  },
  {
    "directory": "TESTDIR",
    "command": "cc -c TESTDIR/build-error3.cc",
    "file": "TESTDIR/build-error3.cc"
  }
]
