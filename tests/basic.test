// This is an LLVM-style lit test that uses FileCheck.
// It creates a tiny two-file project: used.c and unused.c
// Then runs xunused on the temp directory and pipes the output into FileCheck.
//
// RUN: rm -rf %t && mkdir -p %t
// RUN: split-file %s %t
// RUN: sed -e "s|TESTDIR|%t|g" %t/compile_commands.json.in > %t/compile_commands.json
// RUN: xunused %t/compile_commands.json 2>&1 | FileCheck %s
// CHECK: {{.*}}/unused.c:1: warning: Function 'unused' is unused

//--- used.c
void used() {}
int main() { used(); return 0; }

//--- unused.c
void unused() {}

//--- compile_commands.json.in
[
  {
    "directory": "TESTDIR",
    "command": "cc -c TESTDIR/used.c",
    "file": "TESTDIR/used.c"
  },
  {
    "directory": "TESTDIR",
    "command": "cc -c TESTDIR/unused.c",
    "file": "TESTDIR/unused.c"
  }
]
